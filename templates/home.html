<!DOCTYPE html>

{% extends "index.html" %} {% block head %} {{ super() }}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/home.css') }}"
/>
<script>
  // Make user data available to JavaScript
  window.userData = {
    firstName: "{{ current_user.first_name }}",
    role: "{{ current_user.role.value|title }}",
    profilePicture: "{{ current_user.profile_picture or '' }}",
    homeUrl: "{{ url_for('home.home') }}"
  };
</script>
{% endblock %} {% block content %}
<!-- NavBar 
<div id="navbar"></div>
 Breadcrumbs 
<div id="breadcrumbs"></div>
 Summary Statistics Cards 
<div class="container py-4">
  <- Inventory Overview -->
  <section class="dashboard-section">
    <div class="section-header">
      <h2 class="section-title">Inventory Overview</h2>
      <p class="section-subtitle">Totals across all item categories.</p>
    </div>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-3">
      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-primary">
              <i class="fas fa-flask"></i>
            </div>
            <h3 class="stat-card-title">Consumables</h3>
            <p class="stat-card-value" id="stat-consumables>
              {{ consumables_total }} Items
            </p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-info">
              <i class="fas fa-camera"></i>
            </div>
            <h3 class="stat-card-title">Camera Gear</h3>
            <p class="stat-card-value" id="stat-camera-gear">
              {{ camera_gear_total }} Items
            </p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-success">
              <i class="fas fa-microscope"></i>
            </div>
            <h3 class="stat-card-title">Lab Equipment</h3>
            <p class="stat-card-value" id="stat-lab-equipment">
              {{ lab_equipment_total }} Items
            </p>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-warning">
              <i class="fas fa-layer-group"></i>
            </div>
            <h3 class="stat-card-title">Total Inventory</h3>
            <p class="stat-card-value" id="stat-total">
              {{ inventory_total }} Items
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Consumables Stats -->
  <section class="dashboard-section">
    <div class="section-header">
      <h2 class="section-title">Consumables</h2>
      <p class="section-subtitle">Expiration timelines and stock levels.</p>
    </div>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-3">
      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-danger">
              <i class="fas fa-hourglass-half"></i>
            </div>
            <h3 class="stat-card-title">Next Expiration</h3>
            {% if next_expiring %}
            <p class="stat-card-value" id="stat-next-expiration">
              {{ days_until_expiration }} days
            </p>
            <small class="text-muted d-block">
              {{ next_expiring.name }} ({{ next_expiring.expires.strftime("%b %d, %Y") }})
            </small>
            {% else %}
            <p class="stat-card-value" id="stat-next-expiration">
              No upcoming expirations
            </p>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-danger">
              <i class="fas fa-ban"></i>
            </div>
            <h3 class="stat-card-title">Expired Items</h3>
            <p class="stat-card-value" id="stat-expired">
              {{ expired_count }} Items
            </p>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-warning">
              <i class="fas fa-clock"></i>
            </div>
            <h3 class="stat-card-title">Expiring Soon</h3>
            <p class="stat-card-value" id="stat-expiring-soon">
              {{ expiring_soon_count }} Items
            </p>
            <small class="text-muted d-block">Within 14 days</small>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-secondary">
              <i class="fas fa-exclamation-circle"></i>
            </div>
            <h3 class="stat-card-title">Out of Stock</h3>
            <p class="stat-card-value" id="stat-out-of-stock">
              {{ out_of_stock_count }} Items
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Camera Gear Stats -->
  <section class="dashboard-section">
    <div class="section-header">
      <h2>Camera Gear</h2>
      <p class="section-subtitle">Usage and availability.</p>
    </div>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3">
      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-info">
              <i class="fas fa-external-link-alt"></i>
            </div>
            <h3 class="stat-card-title">Checked Out</h3>
            <p class="stat-card-value" id="stat-checked-out">
              {{ checked_out_count }} Items
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Lab Equipment Stats -->
  <section class="dashboard-section">
    <div class="section-header">
      <h2 class="section-title">Lab Equipment</h2>
      <p class="section-subtitle">Maintenance schedules and overdue service.</p>
    </div>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3">
      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-success">
              <i class="fas fa-tools"></i>
            </div>
            <h3 class="stat-card-title">Next Service</h3>
            {% if next_service_equipment %}
            <p class="stat-card-value" id="stat-next-service">
              {{ days_until_service }} days
            </p>
            <small class="text-muted d-block">
              {{ next_service_equipment.name }} ({{ next_service_date.strftime("%b %d, %Y") }})
            </small>
            {% else %}
            <p class="stat-card-value" id="stat-next-service">
              No scheduled service
            </p>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="col">
        <div class="stat-card stat-card-compact">
          <div class="stat-card-body">
            <div class="stat-card-icon text-danger">
              <i class="fas fa-wrench"></i>
            </div>
            <h3 class="stat-card-title">Service Overdue</h3>
            <p class="stat-card-value" id="stat-service-overdue">
              {{ service_overdue|length }} Items
            </p>
            {% if service_overdue %}
            <small class="text-muted d-block">
              {{ service_overdue|map(attribute='name')|join(', ') }}
            </small>
            {% else %}
            <small class="text-muted d-block">All equipment up to date</small>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ADMIN TOOLS â€“ DELETE TAGS & LOCATIONS (Fixes #90 and #91) -->
  {% if current_user.role == 'admin' %}
  <section class="dashboard-section mt-5">
    <div class="section-header">
      <h2 class="section-title">Admin Tools</h2>
      <p class="section-subtitle">Manage tags and storage locations</p>
    </div>

    <div class="row g-4">
      <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title mb-3">
              <i class="fas fa-tags text-primary me-2"></i> Tags
            </h5>
            <div id="tags-management-list" class="small">
              <div class="text-muted">Loading tags...</div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title mb-3">
              <i class="fas fa-map-marker-alt text-info me-2"></i> Locations
            </h5>
            <div id="locations-management-list" class="small">
              <div class="text-muted">Loading locations...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  {% endif %}

</div>

<script src="{{ url_for('static', filename='js/componenets/Navbar.js') }}"></script>
<script src="{{ url_for('static', filename='js/componenets/Breadcrumbs.js') }}"></script>
<script src="{{ url_for('static', filename='js/utils/index.js') }}"></script>
<script src="{{ url_for('static', filename='js/home.js') }}"></script>
{% endblock %}


